(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380],{2635:(e,s,t)=>{Promise.resolve().then(t.bind(t,9126))},9126:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>m});var a=t(5155),r=t(2115),l=t(4186),i=t(9074),d=t(1007),n=t(646),c=t(4861),o=t(8636);function m(){let[e,s]=(0,r.useState)([]),[t,m]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[g,p]=(0,r.useState)(new Date().toISOString().split("T")[0]),[u,b]=(0,r.useState)(!1),[N,j]=(0,r.useState)(null),[y,v]=(0,r.useState)(!1),f=e=>{let s=[];for(let t=9;t<17;t++)for(let a=0;a<60;a+=30){let r="".concat(t.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")),l=S(r,e);w(l)<=w("17:00")&&s.push({time:r,available:!0,duration:e,endTime:l})}return s},w=e=>{let[s,t]=e.split(":").map(Number);return 60*s+t},S=(e,s)=>{let t=w(e)+s,a=Math.floor(t/60);return"".concat(a.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))},k=e=>["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][new Date(e).getDay()];(0,r.useEffect)(()=>{D()},[]),(0,r.useEffect)(()=>{t&&_(t.name)},[t]);let D=async()=>{b(!0);try{let e=await fetch("/api/services-with-duration");if(!e.ok)throw Error("Failed to fetch services");let t=await e.json();s(t)}catch(e){j("Failed to load services"),console.error(e)}finally{b(!1)}},_=async e=>{b(!0);try{let s=await fetch("/api/therapists-by-service/".concat(encodeURIComponent(e)));if(!s.ok)throw Error("Failed to fetch therapists");let t=await s.json();h(t)}catch(e){j("Failed to load therapists"),console.error(e)}finally{b(!1)}},A=async(e,s)=>{if(t)try{let a={client_id:"admin-booking",service_id:t.id,employee_id:e,date:g,time:s.time,notes:"Duration: ".concat(t.duration," minutes (").concat(s.time," - ").concat(s.endTime,")")};if(!(await fetch("/api/appointments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Failed to create booking");alert("Booking created successfully!")}catch(e){alert("Failed to create booking"),console.error(e)}},T=(e,s)=>{let t=k(s);return e.availability_days.includes(t)},C=e=>{let s=new Date(e),t=new Date(s);t.setDate(s.getDate()-1);let a=new Date(s);a.setDate(s.getDate()+1);let r=e=>e.toISOString().split("T")[0],l=r(t),i=r(a),d=x.filter(e=>T(e,l)),n=x.filter(e=>T(e,i));return{previous:{date:l,dayName:k(l),therapists:d},next:{date:i,dayName:k(i),therapists:n}}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(o.A,{darkMode:y}),(0,a.jsx)("div",{className:"ml-64 p-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Booking Administration"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Manage appointments by service, therapist availability, and time slots"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"1. Select Service"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,a.jsxs)("div",{onClick:()=>m(e),className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat((null==t?void 0:t.id)===e.id?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(l.A,{className:"w-4 h-4 text-gray-500"}),(0,a.jsxs)("span",{children:[e.duration," min"]})]}),(0,a.jsxs)("div",{className:"text-purple-600 font-medium",children:["$",e.price]})]})]},e.id))})]}),t&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"2. Select Date"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(i.A,{className:"w-5 h-5 text-gray-500"}),(0,a.jsx)("input",{type:"date",value:g,onChange:e=>p(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"}),(0,a.jsx)("span",{className:"text-gray-600",children:k(g)})]})]}),t&&x.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"3. Available Therapists & Time Slots"}),(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Service: ",(0,a.jsx)("span",{className:"font-medium",children:t.name}),"(",t.duration," minutes) - ",k(g)]}),x.some(e=>T(e,g))?(0,a.jsx)("div",{className:"space-y-6",children:x.map(e=>{if(!T(e,g))return null;let s=f(t.duration);return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-gray-500"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.full_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Employee #",e.employee_number]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Specialties: ",e.expertise.join(", ")]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(n.A,{className:"w-5 h-5 text-green-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-green-600",children:"Available"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2",children:s.map((s,t)=>(0,a.jsxs)("button",{onClick:()=>A(e.id,s),disabled:!s.available,className:"p-2 text-sm border rounded transition-colors ".concat(s.available?"border-green-300 bg-green-50 hover:bg-green-100 text-green-700":"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed"),children:[(0,a.jsx)("div",{className:"font-medium",children:s.time}),(0,a.jsxs)("div",{className:"text-xs",children:["-",s.endTime]})]},t))})]},e.id)})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,a.jsx)(c.A,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Available Bookings Today"}),(0,a.jsxs)("p",{className:"text-gray-600 mb-4",children:['There are no therapists available for "',t.name,'" on ',k(g),", ",new Date(g).toLocaleDateString()]})]}),(()=>{let e=C(g);return e.previous.therapists.length>0||e.next.therapists.length>0?(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsxs)("h4",{className:"text-lg font-medium text-blue-900 mb-4 flex items-center",children:[(0,a.jsx)(i.A,{className:"w-5 h-5 mr-2"}),"Alternative Availability (24 Hours Before & After)"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.previous.therapists.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[(0,a.jsxs)("h5",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-orange-400 rounded-full mr-2"}),"Yesterday (",e.previous.dayName,")"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:new Date(e.previous.date).toLocaleDateString()}),(0,a.jsx)("div",{className:"space-y-3",children:e.previous.therapists.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:s.full_name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["#",s.employee_number]})]}),(0,a.jsx)("button",{onClick:()=>p(e.previous.date),className:"px-3 py-1 text-xs bg-orange-600 text-white rounded hover:bg-orange-700",children:"Select"})]},s.id))})]}),e.next.therapists.length>0&&(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-blue-200",children:[(0,a.jsxs)("h5",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full mr-2"}),"Tomorrow (",e.next.dayName,")"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:new Date(e.next.date).toLocaleDateString()}),(0,a.jsx)("div",{className:"space-y-3",children:e.next.therapists.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:s.full_name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["#",s.employee_number]})]}),(0,a.jsx)("button",{onClick:()=>p(e.next.date),className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Select"})]},s.id))})]})]}),0===e.previous.therapists.length&&0===e.next.therapists.length&&(0,a.jsx)("div",{className:"text-center py-4",children:(0,a.jsx)("p",{className:"text-gray-600",children:"No availability found for 24 hours before or after the selected date."})})]}):(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:(0,a.jsx)("p",{className:"text-red-700",children:"No availability found for 24 hours before or after the selected date."})})})()]})]}),t&&0===x.length&&!u&&(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(d.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Qualified Therapists"}),(0,a.jsxs)("p",{className:"text-gray-600",children:['No therapists are qualified to perform "',t.name,'" service.']})]})}),u&&(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Loading..."})]})}),N&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsx)("p",{className:"text-red-700",children:N})})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[943,255,441,684,358],()=>s(2635)),_N_E=e.O()}]);