(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[397],{5060:(e,a,t)=>{"use strict";t.d(a,{A:()=>v});var s=t(5155),r=t(2115),n=t(5695),l=t(7340),i=t(1366),d=t(7580),o=t(3562),c=t(4186),x=t(2318),g=t(9420),m=t(2713),h=t(5868),u=t(3332),p=t(381),y=t(3052),f=t(2355),b=t(4416),j=t(4783);function v(e){let{darkMode:a}=e,t=(0,n.useRouter)(),v=(0,n.usePathname)(),[N,w]=(0,r.useState)(!1),[k,A]=(0,r.useState)(!1),C=[{name:"Dashboard",href:"/",icon:l.A},{name:"Conversations",href:"/conversations",icon:i.A},{name:"Clients",href:"/clients",icon:d.A},{name:"Calendar",href:"/calendar",icon:o.A},{name:"Booking Admin",href:"/booking-admin",icon:c.A},{name:"Employees",href:"/employees",icon:x.A},{name:"Voice Calls",href:"/voice-calls",icon:g.A},{name:"Analytics",href:"/analytics",icon:m.A},{name:"Revenue",href:"/revenue",icon:h.A},{name:"Promotions",href:"/promotions",icon:u.A},{name:"Settings",href:"/settings",icon:p.A}],S=e=>"/"===e?"/"===v:v.startsWith(e);return(0,s.jsxs)(s.Fragment,{children:[k&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>A(!1)}),(0,s.jsx)("div",{className:"fixed inset-y-0 left-0 z-40 bg-white border-r border-gray-200 transition-all duration-300 ".concat(N?"w-16":"w-64"," ").concat(k?"translate-x-0":"-translate-x-full"," lg:translate-x-0"),children:(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4",children:[!N&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"S"})}),(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:"Serena"})]}),(0,s.jsx)("button",{onClick:()=>w(!N),className:"hidden lg:flex p-1 rounded-lg hover:bg-gray-100 text-gray-500",children:N?(0,s.jsx)(y.A,{className:"w-5 h-5"}):(0,s.jsx)(f.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>A(!1),className:"lg:hidden p-1 rounded-lg hover:bg-gray-100 text-gray-500",children:(0,s.jsx)(b.A,{className:"w-5 h-5"})})]}),(0,s.jsx)("nav",{className:"flex-1 px-4 space-y-2",children:C.map(e=>{let a=e.icon;return(0,s.jsxs)("button",{onClick:()=>{t.push(e.href),A(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat(S(e.href)?"bg-purple-100 text-purple-600":"text-gray-700 hover:bg-gray-100"),children:[(0,s.jsx)(a,{className:"w-5 h-5 flex-shrink-0"}),!N&&(0,s.jsx)("span",{className:"text-sm",children:e.name})]},e.name)})}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),!N&&(0,s.jsx)("span",{children:"Online"})]}),!N&&(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"Version 1.0.0"})]})]})}),(0,s.jsx)("button",{onClick:()=>A(!0),className:"fixed top-4 left-4 z-50 lg:hidden p-2 rounded-lg bg-white shadow-lg border border-gray-200",children:(0,s.jsx)(j.A,{className:"w-5 h-5"})})]})}},6248:(e,a,t)=>{Promise.resolve().then(t.bind(t,9307))},9307:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>p});var s=t(5155),r=t(2115),n=t(7924),l=t(9420),i=t(9803),d=t(4020),o=t(492),c=t(9424),x=t(2486),g=t(5695),m=t(5060),h=t(6750),u=t.n(h);function p(){var e,a;(0,g.useRouter)();let[t,h]=(0,r.useState)(!1),[p,y]=(0,r.useState)(null),[f,b]=(0,r.useState)(""),[j,v]=(0,r.useState)([]),[N,w]=(0,r.useState)(!0),[k,A]=(0,r.useState)(!1),C=(0,r.useRef)(null),S=(0,r.useRef)(null);(0,r.useEffect)(()=>(console.log("ConversationsPage useEffect running..."),S.current=new(u())("f1f929da8fd632930b80",{cluster:"ap2"}),S.current.subscribe("my-channel").bind("new-message",e=>{console.log("New message received:",e),v(a=>{let t=[...a],s=t.findIndex(a=>a.phone===e.phone);if(-1!==s){let a={id:Date.now().toString(),sender:e.sender,text:e.message,time:e.time,phone:e.phone};t[s]={...t[s],lastMessage:e.message,time:e.time,messages:[...t[s].messages,a]};let r=t.splice(s,1)[0];t.unshift(r)}else{let a={id:Date.now().toString(),client:e.sender_name||"Contact ".concat(e.phone),phone:e.phone,lastMessage:e.message,time:e.time,status:"pending",unread:+("client"===e.sender),tag:"Regular",messages:[{id:Date.now().toString(),sender:e.sender,text:e.message,time:e.time,phone:e.phone}]};t.unshift(a)}return t})}),z(),()=>{S.current&&(S.current.unsubscribe("my-channel"),S.current.disconnect())}),[]),(0,r.useEffect)(()=>{_()},[j,p]);let _=()=>{var e;null==(e=C.current)||e.scrollIntoView({behavior:"smooth"})},z=async()=>{try{w(!0),console.log("Fetching conversations from /api/conversations...");let e=await fetch("/api/conversations");if(e.ok){let a=await e.json();console.log("Conversations fetched:",a),v(a),a.length>0&&y(a[0].id)}else console.error("Failed to fetch conversations:",e.status)}catch(e){console.error("Error fetching conversations:",e)}finally{w(!1)}},E=async()=>{if(!f.trim()||k)return;let e=j.find(e=>e.id===p);if(e)try{A(!0);let a=await fetch("/api/send-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e.phone,message:f.trim()})});if(a.ok)b(""),console.log("Message sent successfully");else{let e=await a.json();console.error("Failed to send message:",e),alert("Failed to send message. Please try again.")}}catch(e){console.error("Error sending message:",e),alert("Error sending message. Please try again.")}finally{A(!1)}},P=j.find(e=>e.id===p);return N?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50",children:[(0,s.jsx)(m.A,{darkMode:t}),(0,s.jsx)("div",{className:"lg:ml-64 flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Loading conversations..."})]})})]}):(0,s.jsxs)("div",{className:"min-h-screen transition-all duration-300 ".concat(t?"bg-gradient-serena-dark":"bg-gradient-to-br from-purple-50 via-white to-pink-50"),"data-oid":"ab1c.n5",children:[(0,s.jsx)(m.A,{darkMode:t,"data-oid":"h7atjo-"}),(0,s.jsxs)("div",{className:"lg:ml-64","data-oid":"k6h4o_x",children:[(0,s.jsx)("header",{className:"border-b transition-all duration-300 backdrop-blur-sm ".concat(t?"bg-gray-800/90 border-gray-700":"bg-white/80 border-purple-100"),"data-oid":"nu66asi",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8","data-oid":"jecddw1",children:(0,s.jsx)("div",{className:"flex items-center justify-between h-16","data-oid":"2prwcmq",children:(0,s.jsx)("div",{className:"flex items-center space-x-4 lg:ml-0 ml-12","data-oid":"6-otkvv",children:(0,s.jsx)("h1",{className:"text-xl font-semibold ".concat(t?"text-white":"text-gray-900"),"data-oid":"t0-g1:y",children:"WhatsApp Conversations"})})})})}),(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6","data-oid":"3_3:qsn",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]","data-oid":"5ns-8m6",children:[(0,s.jsxs)("div",{className:"rounded-xl shadow-sm border ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-purple-100"),"data-oid":"6n7vxkf",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700","data-oid":"hgncdrh",children:(0,s.jsxs)("div",{className:"relative","data-oid":"2gs0dzw",children:[(0,s.jsx)(n.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","data-oid":"qi21ano"}),(0,s.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 rounded-lg border ".concat(t?"border-gray-600 bg-gray-700 text-white placeholder-gray-400":"border-gray-200 bg-gray-50 text-gray-900 placeholder-gray-500"),"data-oid":"d2o-18t"})]})}),(0,s.jsx)("div",{className:"overflow-y-auto h-full","data-oid":"4r2l6y0",children:j.length>0?j.map(e=>(console.log("Rendering conversation:",e),(0,s.jsx)("div",{onClick:()=>y(e.id),className:"p-4 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ".concat(p===e.id?"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-l-purple-500":""),"data-oid":"r:.ywu.",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3","data-oid":"d7vdgev",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium","data-oid":"cvce3n8",children:e.client.charAt(0).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1 min-w-0","data-oid":"-j7x82o",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between","data-oid":"mf57-vv",children:[(0,s.jsx)("h3",{className:"font-medium truncate ".concat(t?"text-white":"text-gray-900"),"data-oid":"ij.ee_k",children:e.client}),(0,s.jsx)("span",{className:"text-xs ".concat(t?"text-gray-400":"text-gray-500"),"data-oid":"w972q6o",children:e.time})]}),(0,s.jsx)("p",{className:"text-sm truncate mt-1 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":"xexm4hw",children:e.lastMessage}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2","data-oid":"uk-20zr",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("VIP"===e.tag?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),"data-oid":"4px.h:s",children:e.tag}),(0,s.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:e.phone||"No phone"})]}),e.unread>0&&(0,s.jsx)("span",{className:"w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center","data-oid":"uwgn51e",children:e.unread})]})]})]})},e.id))):(0,s.jsx)("div",{className:"p-8 text-center",children:(0,s.jsx)("p",{className:"text-gray-500 ".concat(t?"text-gray-400":"text-gray-600"),children:"No conversations yet. Start a new conversation or wait for incoming messages."})})})]}),(0,s.jsx)("div",{className:"lg:col-span-2 rounded-xl shadow-sm border flex flex-col ".concat(t?"bg-gray-800 border-gray-700":"bg-white border-purple-100"),"data-oid":"77::mgw",children:P?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between","data-oid":"jn.lfod",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3","data-oid":"tiz4_.d",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium","data-oid":"6wm7n-g",children:P.client.charAt(0)}),(0,s.jsxs)("div",{"data-oid":":ob.2ni",children:[(0,s.jsx)("h3",{className:"font-medium ".concat(t?"text-white":"text-gray-900"),"data-oid":"zbk074r",children:P.client}),(0,s.jsx)("p",{className:"text-sm text-green-600","data-oid":"ewkwn.0",children:"Online"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2","data-oid":"14-bvfr",children:[(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(t?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"b.8:6ok",children:(0,s.jsx)(l.A,{className:"w-5 h-5 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":"d.9nvso"})}),(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(t?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"m4gk4mo",children:(0,s.jsx)(i.A,{className:"w-5 h-5 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":"1-66cis"})}),(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(t?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":".aiiyqw",children:(0,s.jsx)(d.A,{className:"w-5 h-5 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":"pkq-y_k"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4","data-oid":"pz.6x0x",children:[null==P||null==(e=P.messages)?void 0:e.map(e=>(0,s.jsx)("div",{className:"flex ".concat("client"===e.sender?"justify-start":"justify-end"),"data-oid":"d.zqr.4",children:(0,s.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("client"===e.sender?t?"bg-gray-700 text-gray-100":"bg-gray-100 text-gray-900":"bg-purple-500 text-white"),"data-oid":"l-zck.l",children:[(0,s.jsx)("p",{className:"text-sm","data-oid":"59r4cgh",children:e.text}),(0,s.jsx)("p",{className:"text-xs mt-1 ".concat("client"===e.sender?t?"text-gray-400":"text-gray-500":"text-purple-100"),"data-oid":"6_-y1z_",children:e.time})]})},e.id)),(null==P||null==(a=P.messages)?void 0:a.length)===0&&(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-gray-500 ".concat(t?"text-gray-400":"text-gray-600"),children:"No messages yet. Start the conversation!"})}),(0,s.jsx)("div",{ref:C})]}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700","data-oid":"0237ubl",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2","data-oid":"iury7zk",children:[(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(t?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"fhgo_5z",children:(0,s.jsx)(o.A,{className:"w-5 h-5 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":"2x6id0a"})}),(0,s.jsxs)("div",{className:"flex-1 relative","data-oid":"5kftjfe",children:[(0,s.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),E())},placeholder:"Type a message...",disabled:k||!P,className:"w-full px-4 py-2 pr-12 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed ".concat(t?"border-gray-600 bg-gray-700 text-white placeholder-gray-400":"border-gray-200 bg-white text-gray-900 placeholder-gray-500"),"data-oid":"ltv.khf"}),(0,s.jsx)("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded transition-colors ".concat(t?"hover:bg-gray-600":"hover:bg-gray-100"),"data-oid":"j4i6n1m",children:(0,s.jsx)(c.A,{className:"w-5 h-5 ".concat(t?"text-gray-400":"text-gray-600"),"data-oid":".hr2q_4"})})]}),(0,s.jsx)("button",{onClick:E,disabled:!f.trim()||k||!P,className:"p-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(k?"bg-gray-400 cursor-not-allowed":"bg-purple-500 hover:bg-purple-600"," text-white"),"data-oid":"30tsi8:",children:k?(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,s.jsx)(x.A,{className:"w-5 h-5","data-oid":"8pd2f_3"})})]})})]}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(x.A,{className:"w-8 h-8 text-purple-500"})}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2 ".concat(t?"text-white":"text-gray-900"),children:"Select a conversation"}),(0,s.jsx)("p",{className:"text-sm ".concat(t?"text-gray-400":"text-gray-600"),children:"Choose a conversation from the list to start chatting"})]})})})]})})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[768,441,684,358],()=>a(6248)),_N_E=e.O()}]);