(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[397],{4430:(e,t,a)=>{Promise.resolve().then(a.bind(a,4745))},4745:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var s=a(5155),r=a(2115),n=a(7924),l=a(9420),o=a(9803),i=a(4020),d=a(492),c=a(9424),x=a(2486),g=a(5695),h=a(5060),m=a(6750),u=a.n(m);function p(){var e,t;(0,g.useRouter)();let[a,m]=(0,r.useState)(!1),[p,y]=(0,r.useState)(null),[f,b]=(0,r.useState)(""),[j,v]=(0,r.useState)([]),[w,N]=(0,r.useState)(!0),[k,A]=(0,r.useState)(!1),[C,S]=(0,r.useState)("recent"),_=(0,r.useRef)(null),M=(0,r.useRef)(null);(0,r.useEffect)(()=>(console.log("ConversationsPage useEffect running..."),M.current=new(u())("f1f929da8fd632930b80",{cluster:"ap2"}),M.current.subscribe("my-channel").bind("new-message",e=>{console.log("New message received:",e),v(t=>{let a=[...t],s=a.findIndex(t=>t.phone===e.phone);if(-1!==s){let t={id:Date.now().toString(),sender:e.sender,text:e.message,time:e.time,phone:e.phone};a[s]={...a[s],lastMessage:e.message,time:e.time,messages:[...a[s].messages,t]};let r=a.splice(s,1)[0];a.unshift(r)}else{let t={id:Date.now().toString(),client:e.sender_name||"Contact ".concat(e.phone),phone:e.phone,lastMessage:e.message,time:e.time,status:"pending",unread:+("client"===e.sender),tag:"Regular",messages:[{id:Date.now().toString(),sender:e.sender,text:e.message,time:e.time,phone:e.phone}]};a.unshift(t)}return a})}),R(),()=>{M.current&&(M.current.unsubscribe("my-channel"),M.current.disconnect())}),[]),(0,r.useEffect)(()=>{z()},[j,p]);let z=()=>{var e;null==(e=_.current)||e.scrollIntoView({behavior:"smooth"})},R=async()=>{try{console.log("Fetching conversations from /api/conversations...");let e=await fetch("/api/conversations");if(console.log("Response status:",e.status),e.ok){let t=await e.json();console.log("Conversations fetched successfully:",t.length,"conversations"),console.log("Setting conversations state..."),v(t),t.length>0&&(y(t[0].id),console.log("Selected conversation:",t[0].id)),console.log("Setting loading to false after successful fetch"),N(!1)}else console.error("Failed to fetch conversations:",e.status),N(!1)}catch(e){console.error("Error fetching conversations:",e),N(!1)}},P=async()=>{if(!f.trim()||k)return;let e=j.find(e=>e.id===p);if(e)try{A(!0);let t=await fetch("/api/send-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e.phone,message:f.trim()})});if(t.ok)b(""),console.log("Message sent successfully");else{let e=await t.json();console.error("Failed to send message:",e),alert("Failed to send message. Please try again.")}}catch(e){console.error("Error sending message:",e),alert("Error sending message. Please try again.")}finally{A(!1)}},E=j.find(e=>e.id===p),q=j.filter(e=>"recent"===C?"Regular"===e.tag||"VIP"===e.tag:"Group"===e.tag);return w?(console.log("Still loading..."),(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-pink-50",children:[(0,s.jsx)(h.A,{darkMode:a}),(0,s.jsx)("div",{className:"lg:ml-64 flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-500 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-lg text-gray-600",children:"Loading conversations..."})]})})]})):(console.log("Rendering with ".concat(j.length," conversations, activeTab: ").concat(C)),(0,s.jsxs)("div",{className:"min-h-screen transition-all duration-300 ".concat(a?"bg-gradient-serena-dark":"bg-gradient-to-br from-purple-50 via-white to-pink-50"),"data-oid":"ab1c.n5",children:[(0,s.jsx)(h.A,{darkMode:a,"data-oid":"h7atjo-"}),(0,s.jsxs)("div",{className:"lg:ml-64","data-oid":"k6h4o_x",children:[(0,s.jsx)("header",{className:"border-b transition-all duration-300 backdrop-blur-sm ".concat(a?"bg-gray-800/90 border-gray-700":"bg-white/80 border-purple-100"),"data-oid":"nu66asi",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8","data-oid":"jecddw1",children:(0,s.jsx)("div",{className:"flex items-center justify-between h-16","data-oid":"2prwcmq",children:(0,s.jsx)("div",{className:"flex items-center space-x-4 lg:ml-0 ml-12","data-oid":"6-otkvv",children:(0,s.jsx)("h1",{className:"text-xl font-semibold ".concat(a?"text-white":"text-gray-900"),"data-oid":"t0-g1:y",children:"WhatsApp Conversations"})})})})}),(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6","data-oid":"3_3:qsn",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-200px)]","data-oid":"5ns-8m6",children:[(0,s.jsxs)("div",{className:"rounded-xl shadow-sm border ".concat(a?"bg-gray-800 border-gray-700":"bg-white border-purple-100"),"data-oid":"6n7vxkf",children:[(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700","data-oid":"hgncdrh",children:(0,s.jsxs)("div",{className:"relative","data-oid":"2gs0dzw",children:[(0,s.jsx)(n.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400","data-oid":"qi21ano"}),(0,s.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"w-full pl-10 pr-4 py-2 rounded-lg border ".concat(a?"border-gray-600 bg-gray-700 text-white placeholder-gray-400":"border-gray-200 bg-gray-50 text-gray-900 placeholder-gray-500"),"data-oid":"d2o-18t"})]})}),(0,s.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:[(0,s.jsxs)("button",{onClick:()=>S("recent"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("recent"===C?"bg-white dark:bg-gray-700 text-purple-600 dark:text-purple-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"),children:["Recent Messages",j.filter(e=>"Regular"===e.tag||"VIP"===e.tag).length>0&&(0,s.jsx)("span",{className:"ml-2 bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-400 px-2 py-0.5 rounded-full text-xs",children:j.filter(e=>"Regular"===e.tag||"VIP"===e.tag).length})]}),(0,s.jsxs)("button",{onClick:()=>S("groups"),className:"flex-1 py-2 px-4 rounded-md text-sm font-medium transition-colors ".concat("groups"===C?"bg-white dark:bg-gray-700 text-purple-600 dark:text-purple-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"),children:["Group Chats",j.filter(e=>"Group"===e.tag).length>0&&(0,s.jsx)("span",{className:"ml-2 bg-purple-100 dark:bg-purple-900 text-purple-600 dark:text-purple-400 px-2 py-0.5 rounded-full text-xs",children:j.filter(e=>"Group"===e.tag).length})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",style:{maxHeight:"calc(100vh - 300px)"},"data-oid":"4r2l6y0",children:q.length>0?(0,s.jsx)("div",{className:"space-y-1",children:q.map(e=>(console.log("Rendering conversation:",e),(0,s.jsx)("div",{onClick:()=>y(e.id),className:"p-4 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors ".concat(p===e.id?"bg-purple-50 dark:bg-purple-900/20 border-l-4 border-l-purple-500":""),"data-oid":"r:.ywu.",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3","data-oid":"d7vdgev",children:[(0,s.jsxs)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium relative","data-oid":"cvce3n8",children:[e.client.charAt(0).toUpperCase(),"Group"===e.tag&&(0,s.jsx)("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-white",children:[(0,s.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,s.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,s.jsx)("path",{d:"M22 11v6"}),(0,s.jsx)("path",{d:"M19 14h6"})]})})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0","data-oid":"-j7x82o",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between","data-oid":"mf57-vv",children:[(0,s.jsx)("h3",{className:"font-medium truncate ".concat(a?"text-white":"text-gray-900"),"data-oid":"ij.ee_k",children:e.client}),(0,s.jsx)("span",{className:"text-xs ".concat(a?"text-gray-400":"text-gray-500"),"data-oid":"w972q6o",children:e.time})]}),(0,s.jsx)("p",{className:"text-sm truncate mt-1 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":"xexm4hw",children:e.lastMessage}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2","data-oid":"uk-20zr",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("VIP"===e.tag?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),"data-oid":"4px.h:s",children:e.tag}),(0,s.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:e.phone||"No phone"})]}),e.unread>0&&(0,s.jsx)("span",{className:"w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center","data-oid":"uwgn51e",children:e.unread})]})]})]})},e.id)))}):(0,s.jsxs)("div",{className:"p-8 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-purple-100 dark:bg-purple-800 rounded-full flex items-center justify-center mx-auto mb-4",children:"recent"===C?(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-8 h-8 text-purple-500",children:(0,s.jsx)("path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z"})}):(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-8 h-8 text-purple-500",children:[(0,s.jsx)("path",{d:"M17 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),(0,s.jsx)("circle",{cx:"9",cy:"7",r:"4"}),(0,s.jsx)("path",{d:"M22 11v6"}),(0,s.jsx)("path",{d:"M19 14h6"})]})}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2 ".concat(a?"text-white":"text-gray-900"),children:"recent"===C?"No recent messages":"No group chats"}),(0,s.jsx)("p",{className:"text-sm ".concat(a?"text-gray-400":"text-gray-600"),children:"recent"===C?"Start a conversation or wait for incoming messages":"No group conversations found"})]})})]}),(0,s.jsx)("div",{className:"lg:col-span-2 rounded-xl shadow-sm border flex flex-col ".concat(a?"bg-gray-800 border-gray-700":"bg-white border-purple-100"),"data-oid":"77::mgw",children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between","data-oid":"jn.lfod",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3","data-oid":"tiz4_.d",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium","data-oid":"6wm7n-g",children:E.client.charAt(0)}),(0,s.jsxs)("div",{"data-oid":":ob.2ni",children:[(0,s.jsx)("h3",{className:"font-medium ".concat(a?"text-white":"text-gray-900"),"data-oid":"zbk074r",children:E.client}),(0,s.jsx)("p",{className:"text-sm text-green-600","data-oid":"ewkwn.0",children:"Online"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2","data-oid":"14-bvfr",children:[(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(a?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"b.8:6ok",children:(0,s.jsx)(l.A,{className:"w-5 h-5 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":"d.9nvso"})}),(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(a?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"m4gk4mo",children:(0,s.jsx)(o.A,{className:"w-5 h-5 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":"1-66cis"})}),(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(a?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":".aiiyqw",children:(0,s.jsx)(i.A,{className:"w-5 h-5 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":"pkq-y_k"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4","data-oid":"pz.6x0x",children:[null==E||null==(e=E.messages)?void 0:e.map(e=>(0,s.jsx)("div",{className:"flex ".concat("client"===e.sender?"justify-start":"justify-end"),"data-oid":"d.zqr.4",children:(0,s.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-2 rounded-lg ".concat("client"===e.sender?a?"bg-gray-700 text-gray-100":"bg-gray-100 text-gray-900":"bg-purple-500 text-white"),"data-oid":"l-zck.l",children:[(0,s.jsx)("p",{className:"text-sm","data-oid":"59r4cgh",children:e.text}),(0,s.jsx)("p",{className:"text-xs mt-1 ".concat("client"===e.sender?a?"text-gray-400":"text-gray-500":"text-purple-100"),"data-oid":"6_-y1z_",children:e.time})]})},e.id)),(null==E||null==(t=E.messages)?void 0:t.length)===0&&(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-gray-500 ".concat(a?"text-gray-400":"text-gray-600"),children:"No messages yet. Start the conversation!"})}),(0,s.jsx)("div",{ref:_})]}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700","data-oid":"0237ubl",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2","data-oid":"iury7zk",children:[(0,s.jsx)("button",{className:"p-2 rounded-lg transition-colors ".concat(a?"hover:bg-gray-700":"hover:bg-gray-100"),"data-oid":"fhgo_5z",children:(0,s.jsx)(d.A,{className:"w-5 h-5 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":"2x6id0a"})}),(0,s.jsxs)("div",{className:"flex-1 relative","data-oid":"5kftjfe",children:[(0,s.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},placeholder:"Type a message...",disabled:k||!E,className:"w-full px-4 py-2 pr-12 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed ".concat(a?"border-gray-600 bg-gray-700 text-white placeholder-gray-400":"border-gray-200 bg-white text-gray-900 placeholder-gray-500"),"data-oid":"ltv.khf"}),(0,s.jsx)("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-1 rounded transition-colors ".concat(a?"hover:bg-gray-600":"hover:bg-gray-100"),"data-oid":"j4i6n1m",children:(0,s.jsx)(c.A,{className:"w-5 h-5 ".concat(a?"text-gray-400":"text-gray-600"),"data-oid":".hr2q_4"})})]}),(0,s.jsx)("button",{onClick:P,disabled:!f.trim()||k||!E,className:"p-2 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat(k?"bg-gray-400 cursor-not-allowed":"bg-purple-500 hover:bg-purple-600"," text-white"),"data-oid":"30tsi8:",children:k?(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,s.jsx)(x.A,{className:"w-5 h-5","data-oid":"8pd2f_3"})})]})})]}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)(x.A,{className:"w-8 h-8 text-purple-500"})}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2 ".concat(a?"text-white":"text-gray-900"),children:"Select a conversation"}),(0,s.jsx)("p",{className:"text-sm ".concat(a?"text-gray-400":"text-gray-600"),children:"Choose a conversation from the list to start chatting"})]})})})]})})]})]}))}},5060:(e,t,a)=>{"use strict";a.d(t,{A:()=>v});var s=a(5155),r=a(2115),n=a(5695),l=a(7340),o=a(1366),i=a(7580),d=a(3562),c=a(4186),x=a(2318),g=a(9420),h=a(2713),m=a(5868),u=a(3332),p=a(381),y=a(3052),f=a(2355),b=a(4416),j=a(4783);function v(e){let{darkMode:t}=e,a=(0,n.useRouter)(),v=(0,n.usePathname)(),[w,N]=(0,r.useState)(!1),[k,A]=(0,r.useState)(!1),C=[{name:"Dashboard",href:"/",icon:l.A},{name:"Conversations",href:"/conversations",icon:o.A},{name:"Clients",href:"/clients",icon:i.A},{name:"Calendar",href:"/calendar",icon:d.A},{name:"Booking Admin",href:"/booking-admin",icon:c.A},{name:"Employees",href:"/employees",icon:x.A},{name:"Voice Calls",href:"/voice-calls",icon:g.A},{name:"Analytics",href:"/analytics",icon:h.A},{name:"Revenue",href:"/revenue",icon:m.A},{name:"Promotions",href:"/promotions",icon:u.A},{name:"Settings",href:"/settings",icon:p.A}],S=e=>"/"===e?"/"===v:v.startsWith(e);return(0,s.jsxs)(s.Fragment,{children:[k&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>A(!1)}),(0,s.jsx)("div",{className:"fixed inset-y-0 left-0 z-40 bg-white border-r border-gray-200 transition-all duration-300 ".concat(w?"w-16":"w-64"," ").concat(k?"translate-x-0":"-translate-x-full"," lg:translate-x-0"),children:(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4",children:[!w&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white font-bold text-sm",children:"S"})}),(0,s.jsx)("span",{className:"font-semibold text-gray-900",children:"Serena"})]}),(0,s.jsx)("button",{onClick:()=>N(!w),className:"hidden lg:flex p-1 rounded-lg hover:bg-gray-100 text-gray-500",children:w?(0,s.jsx)(y.A,{className:"w-5 h-5"}):(0,s.jsx)(f.A,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>A(!1),className:"lg:hidden p-1 rounded-lg hover:bg-gray-100 text-gray-500",children:(0,s.jsx)(b.A,{className:"w-5 h-5"})})]}),(0,s.jsx)("nav",{className:"flex-1 px-4 space-y-2",children:C.map(e=>{let t=e.icon;return(0,s.jsxs)("button",{onClick:()=>{a.push(e.href),A(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ".concat(S(e.href)?"bg-purple-100 text-purple-600":"text-gray-700 hover:bg-gray-100"),children:[(0,s.jsx)(t,{className:"w-5 h-5 flex-shrink-0"}),!w&&(0,s.jsx)("span",{className:"text-sm",children:e.name})]},e.name)})}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),!w&&(0,s.jsx)("span",{children:"Online"})]}),!w&&(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"Version 1.0.0"})]})]})}),(0,s.jsx)("button",{onClick:()=>A(!0),className:"fixed top-4 left-4 z-50 lg:hidden p-2 rounded-lg bg-white shadow-lg border border-gray-200",children:(0,s.jsx)(j.A,{className:"w-5 h-5"})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[768,441,684,358],()=>t(4430)),_N_E=e.O()}]);